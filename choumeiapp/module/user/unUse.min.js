define(["jquery","commonUtils"],function(t,i){var o="",e={},a=1,n=20,s=function(){e=i.checkLogin(),e&&(o=e.userId),i.addBack(),i.addMenu(),l.getData(),i.goTop()},l={getData:function(){i.request({data:{userId:o,pageNum:a,pageSize:n},successCallback:l.getCallBack,url:apiConfig.newApi+"user/unfinished-order-list.html"})},getCallBack:function(i){if(0==i.code){var o=i.response.items,e=o.length,s=[];0==e&&1==a&&t("#noContentTips").show(),t.each(o,function(t,i){var o=(i.status,i.orderSn),e=i.itemId,a=(i.salonId,i.ticketNo),n=i.articleCodeId,l=i.isGift,c=i.type,d="",r=i.orderTicketId;s.push('<div class="order-list">'),s.push('<p class="ol-header"><span class="text-overflow">'+i.salonName+"</span>"),s.push('<em class="main-color">未消费</em>'),"MF"==c?s.push('<div class="ol-info" itemId='+e+">"):n?s.push('<div class="ol-info" articleCodeId='+n+">"):s.push('<div class="ol-info" orderSn='+o+">"),s.push('<img onerror="this.src=\'../../images/default_img.png\'" src="'+i.imgUrl+'" class="oli-img"/>'),s.push('<div class="oli-right"><p class="olir-text1 text-overflow">'+i.itemName+"</p>"),n&&"Y"==l&&s.push('<i class="gift-tips">赠送</i>'),(c="MF")?d="臭美价":(d="预约金",n&&"Y"==l&&(d="会员疗程价")),s.push('<p class="olir-text2">'+d+'<span class="main-color">￥'+i.money+"</span></p>"),s.push('<p class="olir-text3">购买时间：'+i.payTime+"</p></div>"),s.push('</div><p class="ol-bottom">'),r?s.push('<span class="olb-btn view-cmticket" ticketNo='+a+">查看臭美券</span>"):n?s.push('<span class="olb-btn view-booking-btn"  articleCodeId='+n+">查看预约单</span>"):s.push('<span class="olb-btn view-booking-btn" orderSn='+o+">查看预约单</span>"),n&&"Y"==l&&s.push('<span class="ol-valid text-overflow">有效期 '+i.giftStartTime+"至 "+i.giftEndTime+"</span>"),s.push("</p></div></div>")}),t("#unUseBox").append(t(s.join(""))),e>=n&&1==a&&t(document).bind("scroll",l.addPageScrollListener),a++,l.addListener()}},addListener:function(){t(".view-cmticket").off("click").on("click",function(){var i=t(this).attr("ticketNo");window.location="ticketDetail.html?ticketNo="+i}),t(".view-booking-btn").off("click").on("click",function(){var i=t(this).attr("orderSn"),o=t(this).attr("articleCodeId");o?window.location="../appoint/appoint-detail.html?articleCodeId="+o:window.location="../appoint/appoint-detail.html?beautySn="+i}),t(".ol-info").off("click").on("click",function(){var i=t(this).attr("itemId"),o=t(this).attr("orderSn"),e=t(this).attr("articleCodeId");i?window.location="../home/itemDetail.html?itemId="+i:o&&(e?window.location="../appoint/appoint-detail.html?articleCodeId="+e:window.location="../appoint/appoint-detail.html?beautySn="+o)})},addPageScrollListener:function(){var i=t(document).height(),o=t(document).scrollTop(),e=t(window).height();o+e>=i&&l.getData()}};return{init:s}});