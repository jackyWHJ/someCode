define(["jquery","commonUtils"],function(e,n){function i(n,i){wx&&(wx.config({debug:!1,appId:n.appId,timestamp:n.timestamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","chooseImage"]}),wx.ready(function(){wx.checkJsApi({jsApiList:["chooseImage","onMenuShareTimeline","onMenuShareAppMessage"],success:function(n){var t;"string"==typeof n?t=e.parseJSON(n):"object"==typeof n&&(t=n),t.checkResult.onMenuShareTimeline&&wx.onMenuShareTimeline({title:i.title,link:i.url,imgUrl:i.icon}),t.checkResult.onMenuShareAppMessage&&wx.onMenuShareAppMessage({title:i.title,desc:i.content,link:i.url,imgUrl:i.icon,type:"link",dataUrl:""})},fail:function(){}})}),wx.error(function(){}))}var t=function(t){e.ajax({url:apiConfig.userApi,method:"POST",data:{code:JSON.stringify({to:"signPackage",type:"Wechat",body:{url:window.location.href.split("#")[0]}})},success:function(o){o=e.parseJSON(o),1!=o.result?n.alert(o.msg):(config=o.data.main,t&&i(config,t))},error:function(e,n){var i="数据请求失败，请稍后再试!";"parseerror"===n&&(i="响应数据格式异常!"),"timeout"===n&&(i="请求超时，请稍后再试!"),"offline"===n&&(i="网络异常，请稍后再试!")}}),e(".share").on("click",function(){e("body").append('<div id="share-wrap"><img src="../../images/12_a.png"><br /><img src="../../images/12_b.png"></div>'),e("#share-wrap").unbind().bind("click",function(){e(this).remove()})})},o=function(){e(".back, #head-img .left-icon").on("click",function(){window.history.back()})},c=function(i){var o={init:function(){o.render()},template:function(n){var i="",t='<section class="grid-block">';e.map(n.centerInfo,function(n){n.imgs.length>1?e.map(n.imgs,function(e){t+='<img src="'+e+'">'}):n.imgs[0]&&(t+='<img src="'+n.imgs[0]+'">'),i+='<section class="equipment-introduction"><h3 class="pink">'+n.title+'</h3><p class="gray">'+p(n.content)+"</p>"+t+"</section></section>",t='<section class="grid-block">'}),e("#makeUpCenter").append(i)},render:function(){n.request({url:apiConfig.newApi+"semipermanent/beautyCenter.html",data:{},successCallback:function(e){e.response&&(o.template(e.response),1==i&&t(e.response.share)),o.event()}})},event:function(){s()}};o.init()},a=function(){e("#phone, #call-phone").on("click",function(){n.confirm(e("#phone-num").text(),{cancelButtonText:"取消",okButtonText:"呼叫"}),e("#confirm_ok_button").append('<a href="tel:'+e("#phone-num").text().replace(/-/g,"")+'"></a>')})},r=function(){e(".call-immediately").on("click",function(){window.location="../appoint/appoint.html?itemId="+n.getQueryString("itemId")})},s=function(){e(".makeup-center").on("click",function(){window.location="http://api.map.baidu.com/marker?location=22.546785,113.962437&title=臭美（深圳）韩式定妆中心&content=南山区华润城，大冲商务中心C座6楼&output=html&src=臭美"})},p=function(e){return"string"==typeof e?e.replace(/\n+/g,"<br/>"):e},l=function(e){var n=(e.imgdiv,e.imgwidth),i=e.biliw,t=e.bilih,o=t*n/i;e.imgdiv.height(o)};return{share:t,title:o,makeUpCenter:c,call:a,appointment:r,map:s,replaceToNewline:p,imgResize:l}});