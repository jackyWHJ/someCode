define(["jquery","commonUtils","jquery.lazyLoad"],function(s,a,n){function i(){if(1!=s("#salonList:hidden").length){var a=o.height();e.scrollTop()+a>=e.height()&&g.action.loadList(),1==g.loadTag.end&&e.off("scroll",i)}}var l="",t="",e=s(document),o=s(window),d=s("#salonList"),c=10,p=0,r=0,g={init:function(){a.addBack(),a.addMenu(),p=a.getQueryString("salonId"),l=window.localStorage.getItem("addrLati")||geoLoc.addrLati,t=window.localStorage.getItem("addrLong")||geoLoc.addrLong,g.view.initImgH(),g.action.salonListInit()},loadTag:{end:!1},data:{listData:{load:function(s){a.request({url:apiConfig.newApi+"salon/branch.html",data:{pageNum:++r,pageSize:c,salonId:p,lati:l,"long":t},successCallback:function(n){0==n.code?s(n):a.showTip(n.message)}})}}},view:{initImgH:function(){function a(){var a=o.width()*l;a=a>280?280:a,s("#imgHResetStyle").remove(),s("<style id='imgHResetStyle'> .sl-imgWrap{height:"+a+"px } </style>").appendTo(s("head"))}var n=690,i=280,l=.9/(n/i);a(),o.on("resize",a)},updateSalonList:function(n){0!=n.code&&a.alert(n.message);var i=n.response.salons;if(0==i.length)return void(g.loadTag.end=!0);var l=[];s.each(i,function(s,a){var n="<li salonId="+a.salonId+"><a href='salonIndex.html?salonId="+a.salonId+'\'><div class="sl-imgWrap"><img  class="sl-img lazy" src="../../images/default_salon.png" data-original="'+a.img+'" alt="臭美店铺" /></div><div class="sl-desc"><div class="clearfix"><h1 class="sl-name text-overflow">'+a.name.substr(0,7)+'</h1><span class="si-star"><span class="sl-xing" id="sl-xing"></span><span class="sl-stars" id="sl-stars">'+a.stars+'</span></span><span class="sl-d-info"><span class="sl-addr">'+a.areaName+'</span><span class="sl-distance">'+a.dist+'</span></span></div><ul class="sl-info"><li class="comment"><span class="tip">评价数&nbsp;&nbsp;</span><span class="num">'+a.commentNum+'</span></li><li class="satisfyNum"><span class="tip">满意数&nbsp;&nbsp;</span><span class="num">'+a.satisfy+'</span></li><li class="csi"><span class="tip">满意度&nbsp;&nbsp;</span><span class="num">'+a.satisfaction+"</span></li></ul></div></a></li>";l.push(n)}),d.append(l.join("")),s("img.lazy").removeClass("lazy").lazyload({effect:"fadeIn"})}},action:{salonListInit:function(){e.on("scroll",i),this.loadList()},loadList:function(){g.data.listData.load(g.view.updateSalonList)}}};return{init:g.init}});