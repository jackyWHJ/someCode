define(["jquery","commonUtils","jquery.lazyLoad","swiper"],function(i,e,s,a){i(".swiper-container:not('.full'),.si-teamIntroWrap").height(137/345*i("body").width());var t={salonId:e.getQueryString("salonId"),init:function(){e.addBack(),e.addMenu(),t.data.load(function(i){t.action.init(i),t.view.init(i)}),i("#back").on("click",function(i){window.location="salonList.html"}),i("img.lazy").removeClass("lazy").lazyload({effect:"fadeIn"})},data:{data:null,load:function(i){var s=window.sessionStorage.getItem("user")||window.localStorage.getItem("user"),a=e.getQueryString("salonId"),t=window.localStorage.getItem("lati")||geoLoc.lati,n=window.localStorage.getItem("lng")||geoLoc.lng;e.request({url:apiConfig.newApi+"salon/salon-detail.html",data:{userId:s?JSON.parse(s).userId:"",salonId:a,lati:t,lng:n},successCallback:function(s){0==s.code?i(s):e.showTip(s.message)}})}},view:{init:function(s){0==s.code?(i("#si-salonName").text(s.response.salon.name),i("#sl-stars").text(s.response.salon.stars),1==s.response.salon.collected?i("#collect").addClass("full"):"",i("#si-addr").text(s.response.salon.addr),i("#salon-phone").attr("href","tel:"+s.response.salon.tel),s.response.salon.branchNum>0&&(i("#si-branchNum").text(s.response.salon.branchNum),i("#si-viewBranch").show()),s.response.salon.commentNum>0&&(i("#si-satifactionWrap").show(),i("#si-commentNum").text(s.response.salon.commentNum),i("#si-satisfaction").text(s.response.salon.satisfaction),i("#si-s-perfect").text(s.response.salon.verySatisfy),i("#si-s-good").text(s.response.salon.satisfy),i("#si-s-bad").text(s.response.salon.unsatisfy)),this.swiper.init(s),this.collect(s),this.itemList.init(s)):e.showTip(s.message)},collect:function(){var s="";i("#collect").click(function(){var a=e.checkLogin(),t=a.userId;e.ajaxRequest({data:{type:"User",to:"collectSalon",body:{salonId:e.getQueryString("salonId"),userId:t}},successCallback:function(a){var t=a.data.main,n=t.info;s=t.isCollect,1==s?i("#collect").removeClass("full").addClass("cancel-scale"):i("#collect").removeClass("cancel-scale").addClass("do-scale full"),e.showTip(n)},url:apiConfig.userApi})})},swiper:{data:null,init:function(i){this.data=i.response.salon.img,0==i.length&&i.push({img:"../../images/default_salon.png",thumbimg:"../../images/default_salon.png"}),this.smallSwiper.init(i)},smallSwiper:{init:function(e){var s=[],a=e.response.salon.img,n=a.length;i.each(a,function(i,e){s.push('<div class="swiper-slide"><img data-src="'),s.push(e.thumbimg),s.push('" index = "'+i),s.push('" class="swiper-lazy" onerror="src=\'../../images/default_salon.png\'" /></div>')}),i("#smallSwiper").html(s.join(""));var o=null;o=n>1?new Swiper(".swiper-container.small",{autoplay:"2000",speed:700,pagination:".swiper-container.small .swiper-pagination",paginationClickable:!0,preloadImages:!1,lazyLoading:!0,lazyLoadingInPrevNext:!0,loop:!1,autoplayDisableOnInteraction:!1}):new Swiper(".swiper-container.small",{paginationClickable:!0,preloadImages:!1,lazyLoading:!0,lazyLoadingInPrevNext:!0,loop:!1,autoplayDisableOnInteraction:!1}),i("#smallSwiper").one("click",".swiper-slide",function(){i("#fullSwiper").parent().show(),t.view.swiper.fullSwiper.init(o.activeIndex)}),i("#smallSwiper").on("click",".swiper-slide",function(){i("#fullSwiper").parent().show();t.view.swiper.fullSwiper.swiper})}},fullSwiper:{swiper:null,init:function(e){var s=[],a=i("#fullSwiper");i.each(t.view.swiper.data,function(i,e){s.push('<div class="swiper-slide"><img data-src="'),s.push(e.img),s.push('" index = "'+i),s.push('" class="swiper-lazy" onerror="this.src=\'./../images/default_salon.png\'" /></div>')}),a.html(s.join("")),this.swiper=new Swiper(".swiper-container.full",{autoplay:!1,pagination:".swiper-container.full .swiper-pagination",paginationClickable:!0,preloadImages:!1,lazyLoading:!0,lazyLoadingInPrevNext:!0,loop:!0}),a.on("click",function(){a.parent().hide()})}}},itemList:{init:function(s){var a=s.response.item,n=(a.length,[]),o=[];i.each(a,function(e,s){var a=s.itemShowType,t=s.type,l=s.list;0!=l.length&&(2==a?n.push('<li class="red-color special">'+t+"</li>"):n.push("<li>"+t+"</li>"),o.push("<dl><dt>"+t+"("+l.length+")</dt>"),i.each(l,function(i,e){var s=e.price,t=e.priceOri;o.push('<dd itemId = "'+e.itemId+'" showType="'+a+'"><h1 class="name text-overflow">'+e.name+"</h1>"),o.push('<div class="price"><div class="cmPrice"><span class="label">臭美价：</span><span class="text red-color">￥'),o.push(s+"</span></div>"),o.push('<div class="oriPrice"><span class="label">原&nbsp;&nbsp;价：</span><span class="text">￥'+t+"</span></div>"),1==a&&(o.push('<div class="price"><div class="cmPrice"><span class="label">原&nbsp;&nbsp;价：</span><span class="text red-color">￥'),o.push(t+"</span></div>")),o.push("</div></dd>")}),o.push("</dl>"))}),i("#si-itemCatalog").html(n.join("")),i("#si-itemList").append(o.join(""));var l=i(document),c=i("#si-itemList dt"),r=[],p=-1,d=c.length,m=i("#si-itemCatalog li"),u=i("#si-itemLabel");m.eq(0).addClass("active"),i.each(c,function(e,s){s=i(s),c[e]=s,0==e?r.push(s.position().top-33):r.push(s.position().top-66)}),i("#si-itemCatalog").on("click","li",function(){i(this).addClass("active").siblings().removeClass("active");var e=i(this).index("#si-itemCatalog li");0==e?i("body").animate({scrollTop:r[e]}):i("body").animate({scrollTop:r[e]+33})}),t.action.initViewItemDetail();var h=i("#si-itemCotent").position().top,g=i("#si-itemCatalog"),w=i(".header").height();e.isOpenInWechat&&navigator.userAgent.indexOf("iPhone")>-1&&l.on("touchmove",function(){l.trigger("scroll")}),l.on("scroll",function(){l.scrollTop()>h-w?(g.addClass("fixed"),u.addClass("fixed")):(g.removeClass("fixed"),u.removeClass("fixed"),p=-1);var i=-1;for(i;r[i+1]<l.scrollTop()&&d>i;i++);return i>d||i==p?void(0>i&&u.hide()):(p=i,u.css("display","block"),u.text(c[p].text()),void m.eq(p).addClass("active").siblings().removeClass("active"))})}}},action:{init:function(i){this.initJumpBaiDu(i),this.initJoinComment(i),this.initViewTeam(i),this.initViewBranch()},initJumpBaiDu:function(e){i("#jonBaiDu").on("click",function(){var s=e.response.salon.lati,a=e.response.salon.lng;window.location="http://api.map.baidu.com/marker?location="+s+","+a+"&title="+i("#si-salonName").text()+"&content="+i("#si-addr").text()+"&output=html&src=臭美"})},initJoinComment:function(s){i("#si-satifactionWrap").on("click",function(){location="../home/viewComment.html?type=1&salonId="+e.getQueryString("salonId")})},initViewTeam:function(e){if(0==e.code){var s=e.response.salon.teamImg,a=i("#si-teamWrap");s&&""!=s&&(i("#si-teamImg").attr("src",s[0].thumbimg),a.show())}a.on("click",function(){location="team.html?salonId="+t.salonId})},initViewBranch:function(){i("#si-viewBranch").on("click",function(){location="branch.html?salonId="+t.salonId})},initViewItemDetail:function(){i("#si-itemList dd").on("click",function(){var e=i(this).attr("showType");2==e?location="../home/limitedTimeItemDetail.html?itemId="+i(this).attr("itemId"):location="../home/itemDetail.html?itemId="+i(this).attr("itemId")})}}};return{init:t.init}});