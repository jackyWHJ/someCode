define(["jquery","commonUtils","jquery.lazyLoad","swiper"],function(a,i,t,s){var n={init:function(){this.loadTag={end:!1,firstTime:!0},this.view.resetImgH(),this.action.salonListInit(),i.goTop(),i.addBack()},loadTag:{end:!1,firstTime:!0},getData:function(a){var t={pageNum:++d.data.page,pageSize:d.data.pageSize,district:d.data.district,zone:d.data.zone,"long":c.addr.addrLong,lati:c.addr.addrLati,keyword:d.data.keyword};i.request({url:apiConfig.newApi+"salon/nearby.html",data:t,successCallback:function(t){0==t.code?a(t):i.showTip(t.message)}})},view:{resetImgH:function(){function i(){var i=a(window).width()*n;i>280?i=280:"",a("#imgHResetStyle").remove(),a("<style id='imgHResetStyle'> .sl-imgWrap{height:"+i+"px } </style>").appendTo(a("head"))}var t=690,s=280,n=.9/(t/s);i(),a(window).on("resize",i)},updateSalonList:function(i){console.dir(i);var t=i.response.salons;if(0==t.length)return n.loadTag.end=!0,n.loadTag.firstTime&&(a("#noResearchResult").show(),a("#salonList").hide()),-1;n.loadTag.firstTime=!1,a("#noResearchResult").hide(),a("#salonList").show();var s=[];console.dir(t),1==d.data.page&&a("#salonList").empty(),a.each(t,function(a,i){var t="<li salonId="+i.salonId+'><div class="sl-imgWrap"><img  class="sl-img lazy" src="../../images/default_salon.png" data-original="'+i.img+'" alt="臭美店铺" /></div><div class="sl-desc"><div class="clearfix"><h1 class="sl-name text-overflow">'+i.name+'</h1><span class="si-star"><span class="sl-xing"></span><span class="sl-stars">'+i.stars+'</span></span><span class="sl-d-info"><span class="sl-addr">'+i.areaName+'</span><span class="sl-distance">'+i.dist+'</span></span></div><ul class="sl-info"><li class="comment"><span class="tip">评价数&nbsp;&nbsp;</span><span class="num">'+i.commentNum+'</span></li><li class="satisfyNum"><span class="tip">满意数&nbsp;&nbsp;</span><span class="num">'+i.satisfy+'</span></li><li class="csi"><span class="tip">满意度&nbsp;&nbsp;</span><span class="num">'+i.satisfaction+"</span></li></ul></div></li>";s.push(t)}),a("#salonList").append(s.join("")),a("img.lazy").removeClass("lazy").lazyload({effect:"fadeIn"})}},action:{salonListInit:function(){function i(){if(1!=a("#salonList:hidden").length){var t=a(document),s=a(window).height();t.scrollTop()+s>=t.height()&&n.getData(n.view.updateSalonList),1==n.loadTag.end&&t.off("scroll",i)}}a(document).on("scroll",i);var t=a("#salonList");t.on("click","li",function(){window.location="salonIndex.html?salonId="+a(this).attr("salonId")}),t.empty()}}},e=a("#circle"),o=a("#district"),l=a("#zone"),d={data:{page:0,pageSize:20,district:0,zone:0,districtList:null,keyword:i.getQueryString("keyword")},init:function(){this.initHeader(),this.initDistrictList(),n.init()},initHeader:function(){d.data.keyword&&(a("#h-itemName").text(d.data.keyword),a("#sl-h-pos").on("click",function(){var i=a(this);i.toggleClass("active"),e.toggle()}))},initDistrictList:function(){i.request({url:apiConfig.newApi+"location/allArea.html",data:{type:0},successCallback:function(a){0==a.code?(d.data.districtList=a.response,d.setDistrict(),n.getData(n.view.updateSalonList)):i.showTip(a.message)}})},setDistrict:function(){var i=[];a.each(d.data.districtList,function(a,t){i.push('<li district="'+t.tId+'">'+t.tName+"</li>")}),o.html(i.join(""));var t=o.find("li:first");t.addClass("active"),d.data.district=t.attr("district"),d.setZoom(),o.on("click","li",function(){d.data.district=a(this).attr("district"),d.setZoom()})},setZoom:function(){o.find("li[district="+d.data.district+"]").addClass("active").siblings().removeClass("active");var i=[],t=[];a.each(d.data.districtList,function(a,i){d.data.district==i.tId&&(t=i.areaInfo)}),a.each(t,function(a,t){i.push('<li zone="'+t.areaId+'">'+t.areaName+"</li>")}),d.data.zone=l.html(i.join("")).find("li:first").addClass("active").attr("zone"),l.off("click").on("click","li",function(){var i=a(this);i.addClass("active").siblings().removeClass("active"),d.data.zone=i.attr("zone"),a("#sl-h-posText").text(o.find("li[district="+d.data.district+"]").text()),a("#sl-h-pos").click(),d.data.page=0,n.loadTag={end:!1,firstTime:!0},n.getData(n.view.updateSalonList)})}},c={addr:{addrLati:window.localStorage.getItem("addrLati")||geoLoc.addrLati,addrLong:window.localStorage.getItem("addrLong")||geoLoc.addrLong}};return d});