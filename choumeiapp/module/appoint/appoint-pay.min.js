define(["jquery","commonUtils"],function(e,t){var n=1,a=null,i=0,o=function(){var a=JSON.parse(sessionStorage.getItem("appoint-bill"));return a?(t.addBack(),t.addMenu(),a=a.response,c(a),console.dir(a),t.isOpenInWechat()?(e(".pay-item:eq(0)").remove(),n=2):e(".pay-item:eq(1)").remove(),s(),d(),void 0):void t.alert("项目不存在，请重新预约")},s=function(){e(".pay-item").on("click",function(){var t=e(this);t.find(".pay-choice").addClass("select-btn"),t.siblings().find(".pay-choice").removeClass("select-btn"),n=t.attr("payWay")})},c=function(t){var n=t.groups,o=t.charges,s=[],c=[];e.each(n,function(t,n){0!=n.items.length&&(s.push('<div class="appoint-selected-itemWrap"><div class="title">'),s.push(n.groupName+"</div>"),s.push('<div class="content"><div class="leftCon">预约项目</div><ul class="rightCon">'),e.each(n.items,function(e,t){s.push("<li>"+t.itemName+"</li>")}),s.push("</ul></div></div>"))}),e("#itemList").html(s.join("")),e.each(o,function(e,t){c.push('<div class="appoint-row"><span class="tip">'),c.push(t.chargeName+'</span><span class="val">￥'+t.chargeAmount+"</span></div>")}),e("#payItems").html(c.join("")),a=t.orderSn,i=t.thirdpayAmount,e("#date").text(t.bookingDate),e("#bookerName").text(t.bookerName),t.recommendedCode?e("#recommendedCode").text(t.recommendedCode):e("#recommendedCode").parent().hide(),e("#totalCost").text("￥"+t.totalAmount)},d=function(){e("#pay").off().one("click",function(){1==n?p():2==n?u():3==n&&r()})},r=function(){t.request({url:apiConfig.newApi+"payeco/placeh5.html",data:{beautySn:a,amount:i},successCallback:function(e){0==e.code?location=e.response.payUrl:t.alert(e.message)}})},u=function(){var n={beautySn:a,amount:i},o=window.navigator.userAgent,s="bundle=FQA5WK2BN43YRM8Z&version=5.3&device-type=WECHAT&device-dpi="+window.screen.width+"x"+window.screen.height+"&device-model=&device-network=&device-uuid="+t.randomString()+"&device-cpu=&device-os="+o+"&timestamp="+(new Date).getTime()+"&sequence="+t.requestTime+t.requestCount++ +"&access-token="+t.cache.accessToken+"&request="+JSON.stringify(n);s+="&sign="+e.md5(s),s=s.replace(/device-os=([^&]*)(&|$)/,"device-os="+encodeURIComponent(o)+"&"),location=apiConfig.newApi+"wechat/placeh5.html?"+s},p=function(){t.request({url:apiConfig.newApi+"alipay/placeh5.html",data:{beautySn:a,amount:i},successCallback:function(n){if(0==n.code){var a=document.createElement("form"),i=[];a.action="https://mapi.alipay.com/gateway.do?_input_charset=utf8",a.setAttribute("id","alipayForm"),a.className="hide",e.each(n.response.wapPay,function(e,t){i.push('<input value ="'+t+'" name="'+e+'">')}),a.innerHTML=i.join(""),document.body.appendChild(a),a.submit()}else t.alert(n.message)}})};return{init:o}});