define(["jquery","commonUtils"],function(t,i){var e="",s={},c="",a="notuse",o=1,l=20,n=0,d=0,m=0,p=function(){s=i.checkLogin(),s&&(e=s.userId),i.addBack(),i.addMenu(),u.getTicketData(),i.goTop()},u={getTicketData:function(){var t={to:"ticketFlow",type:"Fundflow",body:{userId:e,status:a,page:o,pageSize:l}};i.ajaxRequest({data:t,successCallback:this.getTicketCallBack,url:apiConfig.orderApi})},getTicketCallBack:function(i){if(i.result){var e=i.data.main,s=e.length,c=[],a=i.data.other.totalNum;0==a&&1==o&&t("#noTicketTips").show();for(var n=0;s>n;n++){var d=e[n].isInvalid,m=e[n].itemType;2==d&&2==m?c.push('<div class="mtb-listc overdue-ticket special-price" itemId='+e[n].itemid+" ticketNo="+e[n].ticketNo+">"):1==d&&2==m?c.push('<div class="mtb-list special-price" itemId='+e[n].itemid+" ticketNo="+e[n].ticketNo+">"):2==d&&1==m?c.push('<div class="mtb-list overdue-ticket" itemId='+e[n].itemid+" ticketNo="+e[n].ticketNo+">"):c.push('<div class="mtb-list" itemId='+e[n].itemid+" ticketNo="+e[n].ticketNo+">"),c.push('<div class="mtbl-info"><div class="mtbli-img sprite-img"></div>'),c.push('<div class="mtbli-text"><p class="mtblit-salon-name text-overflow">'+e[n].salonName+"</p>"),c.push('<p class="mtblit-item-name">'+e[n].itemName+"</p>"),c.push('<p class="mtblit-valid-time">有效期：'+e[n].limitTime+"</p>"),c.push("</div></div>"),c.push('<p class="mtbl-bottom">'),2==d&&c.push('<span class="mtbl-ticket-status">已过期</span>'),c.push('<span class="mtbl-ticketno-text">臭美券密码'),c.push('<em class="ticket-no" id="mtbTicketNo">'+e[n].ticketNo.substring(0,4)+" "+e[n].ticketNo.substring(4,8)+"</em></span></p></div>")}if(t("#myTicketBox").append(t(c.join(""))),a>l&&1==o){t(document).bind("scroll",u.addPageScrollListener)}o++,u.addTicketListener()}},addTicketListener:function(){t(".mtb-list").on("click",function(){c=t(this).attr("ticketNo"),window.location="ticketDetail.html?ticketNo="+c})},addPageScrollListener:function(){n=t(document).height(),d=t(document).scrollTop(),m=t(window).height(),d+m>=n&&u.getTicketData()}};return{init:p}});