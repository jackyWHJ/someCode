define(["jquery","commonUtils","jquery.lazyLoad"],function(a,s,i){var t={addrLati:window.localStorage.getItem("addrLati")||geoLoc.addrLati,addrLong:window.localStorage.getItem("addrLong")||geoLoc.addrLong},n=a(".tabItem"),e=a("#nav .navTab");s.addBack(),s.addMenu(),a("#nav").on("click",".navTab",function(){a(this).addClass("active").siblings().removeClass("active"),n.hide(),n.eq(a(this).index(e)).show()});var l={user:JSON.parse(window.sessionStorage.getItem("user")||window.localStorage.getItem("user")),loadTag:{salonList:{firstTime:!0,end:!1},itemList:{firstTime:!0,end:!1}},init:function(){s.checkLogin(),this.view.init(),this.action.init()},data:{listData:{page:{salonPage:0,itemPage:0},load:function(a){var i={type:"User"};"salonList"==a?s.request({url:apiConfig.newApi+"user/salon-collection.html",data:{userId:l.user.userId,pageNum:++this.page.salonPage,pageSize:6,lati:t.addrLati,"long":t.addrLong},successCallback:function(a){0==a.code?l.view.updateSalonList(a.response):s.showTip(a.message)}}):(i.to="favoritesItem",i.body={addrLong:t.addrLong,addrLati:t.addrLati,userId:l.user.userId,page:++this.page.itemPage,pageSize:10},s.ajaxRequest({data:i,successCallback:l.view.updateItemList,url:apiConfig.userApi}))}}},view:{init:function(){this.resetImgH()},resetImgH:function(){function s(){var s=a(window).width()*n;s>280?s=280:"",a("#imgHResetStyle").remove(),a("<style id='imgHResetStyle'> .sl-imgWrap{height:"+s+"px } </style>").appendTo(a("head"))}var i=690,t=280,n=.9/(i/t);s(),a(window).on("resize",s)},updateSalonList:function(s){var i=s.salons;if(l.loadTag.salonList.firstTime&&(a("#salonNum").text(s.salonNum),a("#itemNum").text(s.itemNum)),0==i.length)return l.loadTag.salonList.end=!0,l.loadTag.salonList.firstTime&&(a("#salonList").next().show(),a("#salonNum").text(0)),-1;l.loadTag.salonList.firstTime=!1;var t=[];a.each(i,function(a,s){var i="<li salonId="+s.salonId+'><div class="sl-imgWrap"><img  class="sl-img lazy" src="../../images/default_salon.png" data-original="'+s.img+'" alt="臭美店铺" /></div><div class="sl-desc"><div class="clearfix"><h1 class="sl-name text-overflow">'+s.name+'</h1><span class="si-star"><span class="sl-xing" id="sl-xing"></span><span class="sl-stars" id="sl-stars">'+s.stars+'</span></span><span class="sl-addr text-overflow">'+s.areaName+"&nbsp;|&nbsp;"+s.dist+'</span> </div><ul class="sl-info"><li class="comment"><span class="tip">评价&nbsp;&nbsp;</span><span class="num">'+s.commentNum+'</span></li><li class="satisfyNum"><span class="tip">满意数&nbsp;&nbsp;</span><span class="num">'+s.satisfy+'</span></li><li class="csi"><span class="tip">满意度&nbsp;&nbsp;</span><span class="num">'+s.satisfaction+"</span></li></ul></div>";t.push(i)}),a("#salonList").append(t.join("")),a("img.lazy").removeClass("lazy").lazyload({effect:"fadeIn"})},updateItemList:function(s){if(s.result){var i=s.data.main;if(0==i.length)return l.loadTag.itemList.end=!0,l.loadTag.itemList.firstTime&&a("#itemList").next().show(),-1;l.loadTag.itemList.firstTime=!1;var t=[];console.dir(i),a.each(i,function(a,s){var i="",n="<li itemId="+s.itemId+" addrLati="+s.addrLati+" addrLong="+s.addrLong+">";i=3==s.itemShowType?s.stylistImg:s.img,n+='<img src="../../images/default_img.png" data-original='+i+' alt="臭美项目" class="il-img lazy" />',n+='<div class="il-info"><h1 class="il-name">'+s.itemName+"</h1>",n+='<div class="il-price"><span class="il-pCM text-overflow">臭美价：<span class="red-color">￥'+s.minPrice+"</span></span>",1==s.itemType&&2!=s.itemShowType&&(n+='<span class="il-pOri">原价：￥'+s.minPriceOri+"</span>"),n+='</div><div class="il-shop"><span class="il-shopName">'+s.salonName+'</span><span class="il-shopPos"><span class="il-spName">'+s.areaName+'</span><span class="il-spDis">'+s.dist+"</span></span></div></div></li>",t.push(n)}),a("#itemList").append(t.join("")),a("img.lazy").removeClass("lazy").lazyload({effect:"fadeIn"})}}},action:{init:function(){this.salonListInit(),a(".navTab:eq(1)").one("click",function(){l.action.itemListInit()})},salonListInit:function(){function s(){if(1!=a("#salonList:hidden").length){var i=a(document),t=a(window).height();i.scrollTop()+t>=i.height()&&l.data.listData.load("salonList"),1==l.loadTag.salonList.end&&i.off("scroll",s)}}a(document).on("scroll",s),a("#salonList").on("click","li",function(){location="../salon/salonIndex.html?salonId="+a(this).attr("salonId")}),l.data.listData.load("salonList")},itemListInit:function(){function s(){if(1!=a("#itemList:hidden").length){var i=a(document),t=a(window).height();i.scrollTop()+t>=i.height()&&l.data.listData.load("itemList"),1==l.loadTag.itemList.end&&i.off("scroll",s)}}a(document).on("scroll",s),a("#itemList").on("click","li",function(){location="../home/itemDetail.html?itemId="+a(this).attr("itemId")}),l.data.listData.load("itemList")}}};l.init()});