define(["jquery","commonUtils"],function(e,t){var s="",n={},r="",o="",a="",i="",u="",l="",d="",c="",f=e("#hairdressRefunds"),g=e("#reservationRefunds"),m=function(){n=t.checkLogin(),n&&(s=n.userId),t.addBack(),t.addMenu(),r=t.getQueryString("priceAll"),o=t.getQueryString("ticketNo"),l=t.getQueryString("orderSn"),d=t.getQueryString("bookingSn"),c=t.getQueryString("money"),salonId=t.getQueryString("salonId"),u=t.getQueryString("itemType"),u?(f.hide(),g.show(),e("#reservationNo").text(d),e("#reservationAmount").text("￥"+c)):(g.hide(),f.show(),e("#hairdressNo").text(o.substring(0,4)+" "+o.substring(4,8)),e("#hairdressAmount").text("￥"+r)),y(),h()},h=function(){e("#confirmRefunds").on("click",function(){i="",a=e("#hairdressRefundsStyle").find(".select-current").index()+1,e(".refunds-reason>.arfa-text").each(function(t,s){var n=e(s).attr("data-status");"current"==n&&(i+=t+",")}),i=i.substring(0,i.length-1);var n=e("#otherReason").val();if(i.length<1&&""==n)return t.alert("请选择至少一项退款原因"),!1;if(u){var r={userId:s,reReason:i,otherRereason:n,bookingSn:d,orderSn:l,salonId:salonId,itemType:u};console.log(r),t.request({data:r,successCallback:function(e){if(0==e.code){var s=e.response;window.sessionStorage.setItem("item",JSON.stringify(s)),window.localStorage.setItem("item",JSON.stringify(s)),t.showTip("已收到你的退款申请"),setTimeout(function(){window.location="refundsDetail.html?orderSn="+l},500)}else t.showTip(e.message)},url:apiConfig.newApi+"order/apply-booking-refund.html"})}else{var r={to:"ticketRefundDo",type:"Fundflow",body:{userId:s,ticketNo:o,reType:a,reReason:i}};t.ajaxRequest({data:r,successCallback:function(e){e.result?(t.showTip("申请退款成功，请耐心等待！"),setTimeout(function(){window.location="myRefunds.html"},500)):t.showTip(e.msg)},url:apiConfig.orderApi})}})},y=function(){e("#hairdressRefundsStyle>.arfa-text").on("click",function(){e(this).addClass("select-current").removeClass("select-normal").siblings().addClass("select-normal").removeClass("select-current"),a=e(this).index()}),e(".refunds-reason .arfa-text").on("click",function(){var t=e(this).attr("data-status");"normal"==t?(e(this).addClass("select-current").removeClass("select-normal"),e(this).attr("data-status","current")):(e(this).addClass("select-normal").removeClass("select-current"),e(this).attr("data-status","normal"))})};return{init:m}});