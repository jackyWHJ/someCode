define(["jquery"],function(e){var n=1,o=(new Date).getTime(),t={user:JSON.parse(window.sessionStorage.getItem("user")||window.localStorage.getItem("user"))||{},accessToken:window.localStorage.getItem("accessToken")||"",refreshToken:window.localStorage.getItem("refreshToken")||""},i=function(e){var n=window.location.hash||window.location.search,o=n.substring(1);if(o){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=o.match(t);return null!=i?decodeURI(i[2]):null}return null},a=function(){return window.location.hash.split("?")[0]||""},r=function(n){return e(function(){n.init&&n.init()}),n},s=function(n){var o=e("#showTip"),t=e("body");o.html()?(o.find("div").html(n),o.show()):(t.append('<div class="tip-show" id="showTip"><div>'+n+"</div></div>"),o=e("#showTip")),setTimeout(function(){o.hide()},2e3)},c=function(){var n=e("#loadingDiv"),o=location.toString().substring(0,location.toString().indexOf("module/"))+"/css/images/ajaxloader.gif";if(0===n.length){var t=e("body");t.append('<div id="loadingDiv"><div><img src="'+o+'"><p>努力加载中...</p></div></div>');var n=e("#loadingDiv")}return n.show(),!0},u=function(){e("#loadingDiv").hide()},d=function(){var n=e("#coverBg"),o=e("body");n.html()?n.show():(o.append('<div id="coverBg" class="cover-bg"></div>'),n=e("#coverBg"),n.show())},l=function(){e("#coverBg").hide()},g=function(e){for(var n=0,o=0;o<e.length;o++)e.charAt(o).match(/[\u0391-\uFFE5]/)?n+=2:n++;return n},p=function(e){var n=e;if(!n)return null;try{n=n.replace(/\r\n/g,"<br>"),n=n.replace(/\n/g,"<br>")}catch(o){B(o.message)}return n},f=function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)?!0:!1},h=function(n,o){var t=[],i=e("#swiper-containerWrap"),n=n,a=e("body");t.push('<div class="swiper-container full" id="swiper-container"><div class="swiper-wrapper" id="fullSwiper">');for(var r=0,s=n.length;s>r;r++){var c=n[r].img||n[r].image.url;t.push('<div class="swiper-slide"><img  src="'+c+'" onerror="this.src=\'../../images/default_img.png\'" index = "'+r),t.push('" class="swiper-lazy" /></div>')}t.push('</div><div class="swiper-pagination"></div></div>'),a.find("#swiper-containerWrap").html()||a.append(i),i.html(t.join("")),i.show();var u={autoplay:!1,pagination:".swiper-pagination",paginationClickable:!0,preloadImages:!0,lazyLoading:!1,lazyLoadingInPrevNext:!0,initialSlide:0};e.extend(u,o||{});var d=new Swiper("#swiper-container",u);return i.on("click",function(){i.hide()}),d},v=function(){e("img").error(function(){e(this).attr("src","../../images/default_img.png")})},m=function(){e("body").append('<a href="javascript:void(0)" class="totop_btn" id="gotop"></a>');var n=e("#gotop");window.onscroll=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;e>=250?n.show():n.hide()},n.on("click",function(){e("html,body").animate({scrollTop:0},500)})},w=function(){var n=e(".ticketno"),o="";n.each(function(n,t){var i=e(this);o=i.text(),o=o.substring(0,4)+"&nbsp;"+o.substring(4,8),i.html(o)})},k=function(n){function o(e){var n=new Image;n.onload=function(){s++,t()},n.onerror=function(){s++,t()},n.src=e}function t(){i(),s==r&&a.onFinish()}function i(){a.onProgress(parseFloat(s/r))}var a={data:[],onFinish:function(){},onProgress:function(e){}};a=e.extend(a,n||{});for(var r=a.data.length,s=0,c=0;r>c;c++)o(a.data[c])},b=function(n){function o(n){var o,t=n.substring(n.lastIndexOf(".")+1);/^(png|jpg|jpeg|gif)$/.test(t)?(o=new Image,o.src=n,o.onerror=o.onload=function(){r()}):e.get(n,function(){r(),"css"===t&&e("head").append('<link rel="stylesheet" type="text/css" href="'+n+'">')})}var t={fileList:[],onFinish:function(){},processor:function(e){}};t=e.extend(t,n||{});var i=t.fileList.length,a=i;t.fileList.forEach(function(e,n){o(e)});var r=function(){t.processor(1- --i/a),0==i&&t.onFinish()}},y=function(n){var o=this,t=null,i={data:{ver:"5.3",time:parseInt((new Date).getTime()/1e3),from:window.navigator.userAgent+"#type=WECHAT#os="+window.navigator.userAgent+"#dpi="+e(window).width()+"x"+e(window).height(),seq:o.randomString(),body:{userId:""}},url:apiConfig.userApi,successCallback:null,method:"post",dataType:"json",async:!0,completeCallback:null,showLoading:!0};return e.extend(!0,i,n),i.showLoading&&o.showLoading(),e.ajax({type:i.method,url:i.url,data:{code:JSON.stringify(i.data)},async:i.async,dataType:i.dataType,success:function(e){return i.successCallback?(i.successCallback(e),void(i.showLoading&&o.hideLoading())):(t=e,void(i.showLoading&&o.hideLoading()))},complete:function(){i.completeCallback&&i.completeCallback()},error:function(e,n){i.showLoading&&o.hideLoading();var t="";switch(n){case"parsererror":t="响应数据格式异常!";break;case"timeout":t="请求超时，请稍后再试!";break;case"offline":t="网络异常，请稍后再试!";break;default:t="数据请求失败，请稍后再试!"}o.showTip(t)}}),t},S=function(n){var o=this,t={data:{userId:this.cache.user.userId},url:apiConfig.userApi,successCallback:null,method:"post",dataType:"json",async:!0,completeCallback:null,showLoading:!0};e.extend(!0,t,n),t.data=JSON.stringify(t.data);var i=window.navigator.userAgent,a="bundle=FQA5WK2BN43YRM8Z&version=6.0&device-type=WECHAT&device-dpi="+window.screen.width+"x"+window.screen.height+"&device-model=&device-network=&device-uuid="+(window.localStorage.getItem("device-uuid")?window.localStorage.getItem("device-uuid"):o.randomString())+"&device-cpu=&device-os="+i+"&timestamp="+(new Date).getTime()+"&sequence="+o.requestTime+o.requestCount++ +"&access-token="+this.cache.accessToken;a+="&sign="+e.md5(a+"&request="+t.data),a=a.replace(/device-os=([^&]*)(&|$)/,"device-os="+encodeURIComponent(i)+"&"),-1!=t.url.indexOf("?")?t.url+="&"+a:t.url+="?"+a,t.showLoading&&o.showLoading(),e.ajax({type:t.method,url:t.url,data:{request:t.data},async:t.async,dataType:t.dataType,timeout:15e3,success:function(e){"10689"==e.code||"10609"==e.code?(o.cache.requestArgs=n,o.request({url:apiConfig.newApi+"getAccessTokenByRefreshToken.html",data:{userId:o.cache.user.userId,refreshToken:o.cache.refreshToken},successCallback:function(e){var n=e.response.accessToken;n&&(o.cache.accessToken=n,o.cache.requestArgs.data.accessToken=n,window.localStorage.setItem("accessToken",n),o.request(o.cache.requestArgs))}})):"10614"==e.code?o.authorize():"11016"==e.code?o.alert(e.message,function(){window.sessionStorage.setItem("location",window.location),window.location="../user/userLogin.html"}):t.successCallback&&t.successCallback(e),t.showLoading&&o.hideLoading()},complete:function(){t.completeCallback&&t.completeCallback()},error:function(e,n){t.showLoading&&o.hideLoading();var i="";switch(n){case"parsererror":i="响应数据格式异常!";break;case"timeout":o.alert("网络故障，访问不了臭美服务器，请确认是否可以上网");break;case"offline":i="网络异常，请稍后再试!";break;default:i="数据请求失败，请稍后再试!"}o.showTip(i)}})},T=function(){return t.user&&t.accessToken?t.user:(C(),null)},C=function(){f()?O()||(window.location=apiConfig.newApi+"user/get-userInfo-h5.html?h5_redirect_url="+location.toString().replace(/\?/,"QQQ").replace(/=/,"ZZZ").replace(/&/,"XXX")):(window.sessionStorage.setItem("location",window.location),window.location="../user/userLogin.html")},I=function(){var e=this,n=window.localStorage.getItem("addrlati"),o=window.localStorage.getItem("addrlong");if(!n&&!o)if(window.navigator.geolocation){e.showLoading();var t={enableHighAccuracy:!0,timeout:7e3};window.navigator.geolocation.getCurrentPosition(function(t){var i=t.coords;o=i.longitude,n=i.latitude;var a=new BMap.Point(o,n);BMap.Convertor.translate(a,0,function(){o=a.lng,n=a.lat,window.localStorage.setItem("addrlong",o),window.localStorage.setItem("addrlati",n),e.hideLoading()})},function(n){e.hideLoading(),e.alert("我们为您准备了更好的推荐服务，请允许微信访问地理位置信息\n您可以在“设置”中允许微信访问位置信息。")},t)}else e.alert("浏览器不支持html5来获取地理位置信息")},x=function(e){e=e||32;for(var n="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",o=n.length,t=[],i=0;e>i;i++)t.push(n.charAt(Math.floor(Math.random()*o)));return t.join("")},L=function(e){var n=/^1\d{10}$/;return n.test(e)},A=function(n,o,t){var i=e(".confirm"),a=e("body");if(!(i.length>0)){e.isFunction(o)&&(t=o,o=null),o=e.extend({},o,{cancelButtonText:o&&o.cancelButtonText||"取消",okButtonText:o&&o.okButtonText||"确定",message:n||""});var r=[];r.push('<div class="confirm">'),r.push('<div class="confirm">'),r.push('<div class="confirm-mask"></div>'),r.push('<div class="confirm-div">'),r.push('<div class="confirm-div-top">'),r.push("<p>"+o.message+"</p>"),r.push("</div>"),r.push('<div class="confirm-div-bottom">'),r.push('<span id ="confirm_cancel_button">'+o.cancelButtonText+"</span>"),r.push('<span id ="confirm_ok_button">'+o.okButtonText+"</span>"),r.push("</div>"),r.push("</div>"),r.push("</div>"),a.append(r.join("")),i=e(".confirm"),i.fadeIn("fast");var s=e("#confirm_cancel_button"),c=e("#confirm_ok_button");s.on("click",function(e){e.stopPropagation(),u(),t&&t(!1)}),c.on("click",function(e){e.stopPropagation(),u(),t&&t(!0)});var u=function(){i.fadeOut("fast"),i.remove(),c.off(),s.off()}}},B=function(n,o,t){var i,a=e("body"),r=e(".alert");if(!(r.length>0)){e.isFunction(o)&&(t=o,o=null),o=e.extend({},o,{okButtonText:o&&o.okButtonText||"确定",message:n||""});var s=[];s.push('<div class="alert">'),s.push('<div class="alert-mask"></div>'),s.push('<div class="alert-div">'),s.push('<div class="alert-div-top"><p>'+o.message+"</p></div>"),s.push('<div class="alert-div-bottom"><p>'+o.okButtonText+"</p></div>"),s.push("</div>"),s.push("</div>"),a.append(s.join("")),r=e(".alert"),i=e(".alert-div-bottom > p"),i.on("click",function(e){e.stopPropagation(),r.fadeOut("fast"),r.remove(),i.off(),t&&t()}),r.fadeIn("fast")}},q=function(e){this.require({fileList:["../../utils/module/aes.js"],onFinish:function(){GibberishAES.size(256),e&&e()}})},_=function(e,n,o){this._loadAES(function(){o(GibberishAES.aesEncrypt(e,n?n:e).toString().replace(/\n/g,""))})},j=function(e,n,o){this._loadAES(function(){o(GibberishAES.aesDecrypt(e,n?n:e).toString().replace(/\n/g,""))})},E=function(n,o){e.isFunction(arguments[0])?(o=arguments[0],n=".header"):n?"":n=".header",e(n).append('<span class="back" id="back"></span>'),o||(o=function(){history.go(-1)}),e("#back").on("click",o)},F=function(n){e.isFunction(arguments[0])?(cb=arguments[0],n=".header"):n?"":n=".header",e(n).append('<span id="menu" class="menu"></span>');var o='<div class="menu-wrap" id="menuWrap"><ul class="menu-ul"><li><a href="../home/homePage.html" target="_parent">首页</a></li><li><a href="../user/myPage.html" target="_parent">我的</a></li></ul><div class="mask"></div></div>';e("body").append(o),e("#menu,.menu-wrap").on("click",function(n){e("#menuWrap").toggle()}),e(".mask").on("touchstart",function(n){e("#menuWrap").toggle(),n.preventDefault(),n.stopPropagation()}),e(".mask").on("touchmove",function(e){e.preventDefault(),e.stopPropagation()})},O=function(){var e=i("userInfo");return null!==e?(e||(window.sessionStorage.setItem("location",window.location),window.location="../user/userLogin.html"),user=JSON.parse(e),t.user=user,t.accessToken=user.accessToken,t.refreshToken=user.refreshToken,window.localStorage.setItem("accessToken",user.accessToken),window.localStorage.setItem("refreshToken",user.refreshToken),window.sessionStorage.setItem("user",JSON.stringify(user)),window.localStorage.setItem("user",JSON.stringify(user)),!0):!1};return O(),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var n=0;n<this.length;n++)if(this[n]==e)return n;return-1}),window.localStorage.getItem("device-uuid")||window.localStorage.setItem("device-uuid",x()),function(e){var n=function(e,n){return e<<n|e>>>32-n},o=function(e,n){var o,t,i,a,r;return i=2147483648&e,a=2147483648&n,o=1073741824&e,t=1073741824&n,r=(1073741823&e)+(1073741823&n),o&t?2147483648^r^i^a:o|t?1073741824&r?3221225472^r^i^a:1073741824^r^i^a:r^i^a},t=function(e,n,o){return e&n|~e&o},i=function(e,n,o){return e&o|n&~o},a=function(e,n,o){return e^n^o},r=function(e,n,o){return n^(e|~o)},s=function(e,i,a,r,s,c,u){return e=o(e,o(o(t(i,a,r),s),u)),o(n(e,c),i)},c=function(e,t,a,r,s,c,u){return e=o(e,o(o(i(t,a,r),s),u)),o(n(e,c),t)},u=function(e,t,i,r,s,c,u){return e=o(e,o(o(a(t,i,r),s),u)),o(n(e,c),t)},d=function(e,t,i,a,s,c,u){return e=o(e,o(o(r(t,i,a),s),u)),o(n(e,c),t)},l=function(e){for(var n,o=e.length,t=o+8,i=(t-t%64)/64,a=16*(i+1),r=Array(a-1),s=0,c=0;o>c;)n=(c-c%4)/4,s=c%4*8,r[n]=r[n]|e.charCodeAt(c)<<s,c++;return n=(c-c%4)/4,s=c%4*8,r[n]=r[n]|128<<s,r[a-2]=o<<3,r[a-1]=o>>>29,r},g=function(e){var n,o,t="",i="";for(o=0;3>=o;o++)n=e>>>8*o&255,i="0"+n.toString(16),t+=i.substr(i.length-2,2);return t},p=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var n="",o=0;o<e.length;o++){var t=e.charCodeAt(o);128>t?n+=String.fromCharCode(t):t>127&&2048>t?(n+=String.fromCharCode(t>>6|192),n+=String.fromCharCode(63&t|128)):(n+=String.fromCharCode(t>>12|224),n+=String.fromCharCode(t>>6&63|128),n+=String.fromCharCode(63&t|128))}return n};e.extend({md5:function(e){var n,t,i,a,r,f,h,v,m,w=Array(),k=7,b=12,y=17,S=22,T=5,C=9,I=14,x=20,L=4,A=11,B=16,q=23,_=6,j=10,E=15,F=21;for(e=p(e),w=l(e),f=1732584193,h=4023233417,v=2562383102,m=271733878,n=0;n<w.length;n+=16)t=f,i=h,a=v,r=m,f=s(f,h,v,m,w[n+0],k,3614090360),m=s(m,f,h,v,w[n+1],b,3905402710),v=s(v,m,f,h,w[n+2],y,606105819),h=s(h,v,m,f,w[n+3],S,3250441966),f=s(f,h,v,m,w[n+4],k,4118548399),m=s(m,f,h,v,w[n+5],b,1200080426),v=s(v,m,f,h,w[n+6],y,2821735955),h=s(h,v,m,f,w[n+7],S,4249261313),f=s(f,h,v,m,w[n+8],k,1770035416),m=s(m,f,h,v,w[n+9],b,2336552879),v=s(v,m,f,h,w[n+10],y,4294925233),h=s(h,v,m,f,w[n+11],S,2304563134),f=s(f,h,v,m,w[n+12],k,1804603682),m=s(m,f,h,v,w[n+13],b,4254626195),v=s(v,m,f,h,w[n+14],y,2792965006),h=s(h,v,m,f,w[n+15],S,1236535329),f=c(f,h,v,m,w[n+1],T,4129170786),m=c(m,f,h,v,w[n+6],C,3225465664),v=c(v,m,f,h,w[n+11],I,643717713),h=c(h,v,m,f,w[n+0],x,3921069994),f=c(f,h,v,m,w[n+5],T,3593408605),m=c(m,f,h,v,w[n+10],C,38016083),v=c(v,m,f,h,w[n+15],I,3634488961),h=c(h,v,m,f,w[n+4],x,3889429448),f=c(f,h,v,m,w[n+9],T,568446438),m=c(m,f,h,v,w[n+14],C,3275163606),v=c(v,m,f,h,w[n+3],I,4107603335),h=c(h,v,m,f,w[n+8],x,1163531501),f=c(f,h,v,m,w[n+13],T,2850285829),m=c(m,f,h,v,w[n+2],C,4243563512),v=c(v,m,f,h,w[n+7],I,1735328473),h=c(h,v,m,f,w[n+12],x,2368359562),f=u(f,h,v,m,w[n+5],L,4294588738),m=u(m,f,h,v,w[n+8],A,2272392833),v=u(v,m,f,h,w[n+11],B,1839030562),h=u(h,v,m,f,w[n+14],q,4259657740),f=u(f,h,v,m,w[n+1],L,2763975236),m=u(m,f,h,v,w[n+4],A,1272893353),v=u(v,m,f,h,w[n+7],B,4139469664),h=u(h,v,m,f,w[n+10],q,3200236656),f=u(f,h,v,m,w[n+13],L,681279174),m=u(m,f,h,v,w[n+0],A,3936430074),v=u(v,m,f,h,w[n+3],B,3572445317),h=u(h,v,m,f,w[n+6],q,76029189),f=u(f,h,v,m,w[n+9],L,3654602809),m=u(m,f,h,v,w[n+12],A,3873151461),v=u(v,m,f,h,w[n+15],B,530742520),h=u(h,v,m,f,w[n+2],q,3299628645),f=d(f,h,v,m,w[n+0],_,4096336452),m=d(m,f,h,v,w[n+7],j,1126891415),v=d(v,m,f,h,w[n+14],E,2878612391),h=d(h,v,m,f,w[n+5],F,4237533241),f=d(f,h,v,m,w[n+12],_,1700485571),m=d(m,f,h,v,w[n+3],j,2399980690),v=d(v,m,f,h,w[n+10],E,4293915773),h=d(h,v,m,f,w[n+1],F,2240044497),f=d(f,h,v,m,w[n+8],_,1873313359),m=d(m,f,h,v,w[n+15],j,4264355552),v=d(v,m,f,h,w[n+6],E,2734768916),h=d(h,v,m,f,w[n+13],F,1309151649),f=d(f,h,v,m,w[n+4],_,4149444226),m=d(m,f,h,v,w[n+11],j,3174756917),v=d(v,m,f,h,w[n+2],E,718787259),h=d(h,v,m,f,w[n+9],F,3951481745),f=o(f,t),h=o(h,i),v=o(v,a),m=o(m,r);var O=g(f)+g(h)+g(v)+g(m);return O.toUpperCase()}})}(jQuery),{requestCount:n,requestTime:o,cache:t,getQueryString:i,getHashStr:a,library:r,showTip:s,showLoading:c,hideLoading:u,showCover:d,hideCover:l,strlen:g,transferString:p,isOpenInWechat:f,showSwipeBox:h,imgError:v,goTop:m,ticketNoStr:w,loaderImg:k,require:b,ajaxRequest:y,request:S,checkLogin:T,authorize:C,checkGeoLoc:I,randomString:x,isPhone:L,confirm:A,alert:B,_loadAES:q,aesEncrypt:_,aesDecrypt:j,addBack:E,addMenu:F}});