define(["jquery","commonUtils","utils/module/tongdun"],function(e,t,o){var n={},a="",c="",i=e("#activatePromocodeText"),s=e("#btnActivate"),d=e("#errorTips"),u=e("#btnJump"),r=function(){n=t.checkLogin(),n&&(a=n.userId),t.addBack(),t.addMenu(),l()},l=function(){m.addActivateBtnListener(),u.on("click",function(){m.pageBack()})},m={getMyPromocodeData:function(e){var e={userId:a,recommendedCode:c};t.request({data:e,successCallback:m.getCallback,url:apiConfig.newApi+"recommended-code/query.html"})},getCallback:function(e){if(0==e.code){var o=e.response,n=o.type,i=o.message;t.confirm(i,{okButtonText:"确认激活"},function(e){e&&t.request({data:{userId:a,type:n,recommendedCode:c},successCallback:function(e){0==e.code?(t.showTip("激活成功"),setTimeout(function(){m.pageBack()},1e3)):t.showTip(e.message)},url:apiConfig.newApi+"recommended-code/submit.html"})})}else t.showTip(e.message)},addActivateBtnListener:function(){s.on("click",function(){e(this).hasClass("activate-status")&&(c=i.val().replace(/\s+/g,""),c?(m.getMyPromocodeData(),tongdun({url:"user/invite-code/consume.html",data:{authCode:c}})):d.show().text("请输入有效邀请码"))})},pageBack:function(){var e=window.sessionStorage.getItem("location");e?(e.indexOf("userId=")>0&&(e+=n.userId),window.location=e):window.location="../salon/salonList.html"}};return{init:r}});