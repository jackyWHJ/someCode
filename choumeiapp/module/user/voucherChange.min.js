define(["jquery","commonUtils"],function(e,n){var o="",c="",i=1,t=15,s=e("#voucher-tit"),a="",l=function(){o=n.checkLogin(),o&&(c=o.userId),s.on("input",function(){a=s.val(),null!=a?(e("#voucherBtn").removeClass("changeBtn-enable"),e("#voucherDiv").removeClass("voucher-enable")):(e("#voucherBtn").off("click").addClass("changeBtn-enable"),e("#voucherDiv").off("click").addClass("voucher"))}),n.addBack(),n.addMenu(),u(),d()},u=function(){e("#voucherBtn").on("click",function(){a=s.val(),a=a.replace(/\s+/g,""),a.length&&r()})},r=function(){n.request({data:{userId:c,code:a},successCallback:function(e){0==e.code?(n.showTip("兑换成功"),setTimeout(function(){window.location.reload()},1e3)):n.showTip(e.message)},url:apiConfig.newApi+"voucher/redeem.html"})},d=function(){n.request({data:{userId:c,page:i,size:t},successCallback:h,url:apiConfig.newApi+"voucher/redeemed-list.html"})},h=function(o){var c;if(0==o.code){var t=o.response;t.length>0?(c=f(t),e(".voucher-big  ul").append(c),e(".voucher-big").find("li").length>5&&1==i&&e(document).bind("scroll",v),i++):1==i&&e(".voucher-big .no-content").show()}else n.showTip(o.message)},v=function(){var n=e(document).height(),o=e(document).scrollTop(),c=e(window).height();o+c>=n&&d()},f=function(n){var o="";return e.each(n,function(e,n){o+='<li><div class="row2"><span class="row-get text-overflow">'+n.code+' </span><span class="row-pas text-overflow">'+n.title+"</span></div></li></div></li>"}),o};return{init:l}});