define(["jquery","commonUtils"],function(t,e){var i="",o={},a=1,s=20,n=function(){o=e.checkLogin(),o&&(i=o.userId),e.addBack(),e.addMenu(),l.getData(),e.goTop()},l={getData:function(){e.request({data:{userId:i,pageNum:a,pageSize:s},successCallback:l.getCallBack,url:apiConfig.newApi+"user/un-evaluated-list.html"})},getCallBack:function(e){if(0==e.code){var i=e.response.items,o=i.length,n=[];0==o&&1==a&&t("#noContentTips").show(),t.each(i,function(t,e){var i=(e.status,e.orderSn,e.itemId),o=e.salonId,a=e.ticketNo,s=e.orderTicketId;n.push('<div class="order-list">'),n.push('<p class="ol-header"><span class="text-overflow">'+e.salonName+"</span>"),n.push('<em class="main-color">未评价</em>'),n.push('<div class="ol-info" itemId='+i+" salonId="+o+" orderTicketId="+s+">"),n.push('<img onerror="this.src=\'../../images/default_img.png\'" src="'+e.imgUrl+'" class="oli-img"/>'),n.push('<div class="oli-right"><p class="olir-text1 text-overflow">'+e.itemName),n.push('</p><p class="olir-text2">臭美价<span class="main-color">￥'+e.money+"</span></p>"),n.push('<p class="olir-text3">购买时间：'+e.payTime+"</p></div>"),n.push('</div><p class="ol-bottom">'),n.push('<span class="olb-btn view-cmticket" ticketNo='+a+">查看臭美券</span>"),n.push('<span class="olb-btn evaluate-btn" itemId='+i+" salonId="+o+" orderTicketId="+s+">评价</span>"),n.push("</p></div></div>")}),t("#unEvaluateBox").append(t(n.join(""))),o>=s&&1==a&&t(document).bind("scroll",l.addPageScrollListener),a++,l.addListener()}},addListener:function(){t(".evaluate-btn").off("click").on("click",function(){var e=t(this).attr("salonId"),i=t(this).attr("itemId"),o=t(this).attr("orderTicketId"),a=t(this).parent().siblings(".ol-info").find(".olir-text1").text();window.location="evaluateConsume.html?salonId="+e+"&itemId="+i+"&orderTicketId="+o+"&itemName="+encodeURI(a)}),t(".ol-info").off("click").on("click",function(){var e=t(this).attr("itemId");window.location="../home/itemDetail.html?itemId="+e}),t(".view-cmticket").off("click").on("click",function(){var e=t(this).attr("ticketNo");window.location="ticketDetail.html?ticketNo="+e})},addPageScrollListener:function(){var e=t(document).height(),i=t(document).scrollTop(),o=t(window).height();i+o>=e&&l.getData()}};return{init:n}});