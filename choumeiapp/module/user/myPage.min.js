define(["jquery","commonUtils"],function(e,n){var o={},t="",i=e("#ulbLogin"),a=e("#ulbLogged"),s=e("#loginUserImg"),r=e("#userLoginBox"),u=e("#userName"),g=(e("#vipSpan"),function(){if(o=JSON.parse(window.sessionStorage.getItem("user")||window.localStorage.getItem("user")),o&&(t=o.userId),t)o.img?s.css("background-image","url("+o.img+")"):s.css("background-image","url(../../images/user/gerenziliao_touxiang@2x.png)"),u.text(o.nickname),o.growth&&c.setGrade(o.growth,e("#vipSpan")),i.hide(),a.show(),l.getMyCmData(),r.on("click",function(){window.location="myAccount.html"});else{a.hide(),i.show();var g=e("#myPage").height();e("#unLoginCoverBg").height(g-57).show(),r.on("click",function(){window.sessionStorage.setItem("location",window.location),window.location="userLogin.html"}),n.authorize()}n.addBack(),l.addMyCmListener()}),c={getGrade:function(e){return 5>e?["h",e+1]:10>e?["d",e%5+1]:["c",e%5+1]},setGrade:function(e,n){for(var e=this.getGrade(Number(e)),o=[],t=e[0],i=e[1];i>0;i--)o.push("<i class='grade "+t+"'></i>");n.html(o.join(""))}},l={getMyCmData:function(){var e={userId:t};n.request({data:e,successCallback:this.getMyCmCallback,url:apiConfig.newApi+"user/my-choumei-v6.html"})},getMyCmCallback:function(t){if(0==t.code){var i=t.response;o=e.extend(!0,o,i),window.sessionStorage.setItem("user",JSON.stringify(o)),window.localStorage.setItem("user",JSON.stringify(o)),e("#balanceMoney").text("ï¿¥"+i.money),i.headUrl?s.css("background-image","url("+i.headUrl+")"):s.css("background-image","url(../../images/user/gerenziliao_touxiang@2x.png)"),e("#userName").text(i.nickname),i.growth!=o.growth&&c.setGrade(i.growth,e("#vipSpan"));var a=i.unUseNum,r=i.unEvaluatedNum;a>0&&e("#unuseNum").show().text(a),r>0&&e("#unevaluateNum").show().text(r)}else n.showTip(t.message)},addMyCmListener:function(){e("#ulbLogged").on("click",function(){window.location="myAccount.html"})}};return{init:g}});