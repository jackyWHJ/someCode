define(["jquery","commonUtils","swiper","jquery.lazyLoad"],function(t,e,i,n){var a=t("#swiperWrapper"),o=t("#circle"),r=function(){d(),l.setPosition(),s(),p()},s=function(){u(),w(),h()},l={addr:{addrLati:window.localStorage.getItem("addrLati")||geoLoc.addrLati,addrLong:window.localStorage.getItem("addrLong")||geoLoc.addrLong},addrCom:null,setPosition:function(){window.navigator.geolocation?(e.showLoading(),window.navigator.geolocation.getCurrentPosition(function(t){var i=t.coords.longitude,n=t.coords.latitude,a=new BMap.Point(i,n);BMap.Convertor.translate(a,0,function(t){window.localStorage.setItem("addrLong",t.lng),window.localStorage.setItem("addrLati",t.lat),l.addr.addrLong=t.lng,l.addr.addrLati=t.lat;var i=new BMap.Geocoder;i.getLocation(t,function(t){l.addrCom=t.addressComponents,c(l.addrCom)}),e.hideLoading()})},function(t){e.alert("我们为您准备了更好的推荐服务，请允许微信访问地理位置信息\n您可以在“设置”中允许微信访问位置信息。"),c({city:"深圳"}),e.hideLoading()},{enableHighAccuracy:!0,timeout:5e3})):e.alert("浏览器不支持html5来获取地理位置信息")}},c=function(e){var i=e.city;t("#abCurrentCity").find("span").text(i),t("#homeCity").text(i),i!=window.localStorage.getItem("city")&&window.localStorage.setItem("city",i)},d=function(){t("#sl-h-pos").on("click",function(){var e=t(this);e.toggleClass("active"),o.toggle()})},m=function(t){var e=(t.imgdiv,t.imgwidth),i=t.biliw,n=t.bilih,a=n*e/i;t.imgdiv.height(a)},p=function(){t("#itemList,#salonList").find("li").on("click",function(){var e=t(this).attr("data-url");window.location=e})},u=function(){e.request({url:apiConfig.newApi+"promotion/banners.html",data:{},successCallback:function(t){0==t.code?g(t.response):e.showTip(t.message)}})},g=function(e){if(e){var n=[],o=e.posters,r=e.FFABanner,s=e.SPMBanner,l=e.expertBanner;a.html("");for(var c=0,d=o.length;d>c;c++)n.push('<div class="swiper-slide" bannerId="'+o[c].bannerId+'" eventType="'+o[c].eventType+"\" url='"+o[c].url+"' style=\"background:url("+o[c].img+') no-repeat center center;background-size: cover;"></div>');t(n.join("")).appendTo(a),m({imgdiv:t("#activityBanner"),imgwidth:t(window).width(),biliw:375,bilih:200});new i("#activityBanner",{autoplay:"4000",speed:1e3,pagination:".swiper-pagination",paginationClickable:!0,preloadImages:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0,loop:!0});t("#SPMImg").attr("src",s.img).attr("eventType",s.eventType).attr("url",s.url).on("click",function(){window.location="../makeup/semipermanent.html"}),t("#expertImg").attr("src",l.img).attr("eventType",l.eventType).attr("url",l.url).on("click",function(){window.location="../makeup/expert.html"}),t("#FFAImg").attr("src",r.img).attr("eventType",r.eventType).attr("url",r.url).on("click",function(){window.location="../fashion/index.html"}),f()}},f=function(){function i(i){if(n=t(this).attr("url"),o=t(this).attr("eventType"),1==o)window.location=n;else if(2==o){n=JSON.parse(n);var a="";switch(n.type){case"FFA":a="../fashion/listItem.html?itemId="+n.itemId;break;case"SPM":a="../makeup/listItem.html?itemId="+n.itemId;break;case"salon":a="../salon/salonIndex.html?salonId="+n.salonId;break;case"artificers":a="../makeup/expert.html";break;default:e.showTip("事件类型有错！")}window.location=a}}var n="",o="";a.find(".swiper-slide").on("click",i)},w=function(){e.request({url:apiConfig.newApi+"semipermanent/items.html",data:{},successCallback:function(t){0==t.code?v(t.response):e.showTip(t.message)}})},h=function(){e.request({url:apiConfig.newApi+"fast-fasion/index.html",data:{},successCallback:function(t){0==t.code?I(t.response):e.showTip(t.message)}})},v=function(e){if(e){var i=t("#smpItemList"),n=i.find("li"),a=t(".smp-item-detail"),o=e.popArtificer;i.hide();for(var r=0,s=o.length;s>r;r++)n.eq(r).html('<img src="'+o[r].icon+'">'),a.eq(r).find(".smp-item-title").text(o[r].name).attr("itemId",o[r].itemId),a.eq(r).find(".smp-item-desc").text(o[r].desc);i.show(),n.on("click",function(){n.removeClass("active");var e=t(this).addClass("active").attr("data-num");a.hide().eq(e).show()}),t(".smp-item-title").on("click",function(){window.location="../makeup/listItem.html?itemId="+t(this).attr("itemId")})}},I=function(e){if(e){var i=[],n=t("#FFAList"),a=["#fb5d8a","#31e0c9","#fba057","#fb5d8a","#31e0c9","#fba057"];n.html("");for(var o=0,r=e.items.length;r>o;o++)e.items[o].icon||(e.items[o].icon="../../images/default_store_img.png"),i.push('<div class="fast-item-title" itemId="'+e.items[o].itemId+'" style="background: url('+e.items[o].icon+') no-repeat 4.5% center;background-size: 50px 50px;"><p class="text-overflow" style="color: '+a[o]+'">'+e.items[o].name+'</p><p class="text-overflow" >'+e.items[o].desc+"</p></div>");n.html(i.join("")),t(".fast-item-title").on("click",function(){window.location="../fashion/listItem.html?itemId="+t(this).attr("itemId")})}};return{init:r}});