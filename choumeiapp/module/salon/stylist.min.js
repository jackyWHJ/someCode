define(["jquery","commonUtils","swiper"],function(t,i,e){var s,a,l,o,n={pageNum:0,pageSize:5},c=t(window),r=c.height(),d=t(document),g=window.localStorage.getItem("addrLati")||geoLoc.addrLati,u=window.localStorage.getItem("addrLong")||geoLoc.addrLong,m=function(){s=(JSON.parse(window.sessionStorage.getItem("user")||window.localStorage.getItem("user"))||{}).userId,a=i.getQueryString("stylistId"),p(),b(),f()},p=function(){i.request({data:{lati:g,"long":u,stylistId:a},url:apiConfig.newApi+"/stylist/homepage.html",successCallback:h})},h=function(t){0==t.code?(t=t.response,v(t.stylist),y(t.salon)):i.alert(t.message)},f=function(){t("#viewComment").on("click",function(){window.location="../home/viewComment.html?stylistId="+a})},v=function(i){t("#stylist-name").text(i.name),t("#stylist-signature").text(i.signature),t("#stylist-rank").text(i.job),t("#stylist-follower").text(i.likenum),t("#stylist-desc").text(i.desc),t("#stylist-satisfaction").text(i.satisfaction),t("#stylist-appointedNum").text(i.appointedNum),t("#avatar").attr("src",i.img),l=parseInt(i.likenum),k(i.collected)},y=function(i){t("#salon-name").text(i.name),t("#salon-area").text(i.area),t("#salon-dist").text(i.dist),t("#salon-addr").text(i.addr),o=i.imgs,t("#salon-gallery").on("click",function(){L(o,0)}),t("#jonBaiDu").on("click",function(){var t=i.lati,e=i.lng;window.location="http://api.map.baidu.com/marker?location="+t+","+e+"&title="+i.name+"&content="+i.area+"&output=html&src=臭美"})},w=t("#stylist-follow"),k=function(t){t=Number(t),1===t&&w.addClass("actived"),w.on("click",function(){S(I)})},I=function(e){var s=e.data.main,a=Number(s.isCollect),o=s.info;1===a?(l-=1,w.removeClass("actived").addClass("cancel-scale")):(l+=1,w.removeClass("cancel-scale").addClass("do-scale actived")),t("#stylist-follower").text(l),i.showTip(o)},S=function(t){i.checkLogin();var e={data:{type:"Stylist",to:"appraisal",body:{userId:s,stylistId:a}},url:apiConfig.shopApi,successCallback:t};i.ajaxRequest(e)},b=function(){i.request({data:{pageSize:n.pageSize,pageNum:++n.pageNum,stylistId:a},url:apiConfig.newApi+"stylist/works.html",successCallback:function(t){0==t.code?C(t):i.showTip(t.message)}})},x=function(){d.scrollTop()+r>=d.height()&&b()},C=function(i){var e=[],s=i.response;if(0===s.length)return void d.off("scroll",x);t.each(s,function(i,s){e.push("<div class='cell-gallery' id="+s.workId+">"),e.push("<p class='contents'>"+s.desc+"</p>"),e.push("<div class='gallery'>"),s.images.length>1?t.each(s.images,function(t,i){e.push("<div class='photo fl stylist-img' style=\"background: url("+i.thumb.url+') no-repeat center;background-size: cover;" bigImgSrc= '+i.image.url+"></div>")}):e.push("<div class='photo-large fl stylist-img' bigImgSrc= "+s.images[0].url+" ><img src='../../images/default_img.png'  data-original="+s.images[0].url+" bigImgSrc= "+s.images[0].url+"  class='item lazy' alt='造型师作品' /></div>"),e.push("<div class='clean'</div></div><p class='date light-grey'>"+s.time+"</p></div></div></div>"),e.push("<div class='light-line'></div>"),t("#stylist-works").append(e.join(""))});var a=t(".photo").width();t(".photo").css("height",a);var l=t("photo-large").width();t("photo-large").height(l),1==n.pageNum&&(d.on("scroll",x),s.length>0&&t("#noWorks").hide()),N()},N=function(){t(".gallery").off("click").on("click",".stylist-img",function(){for(var i=t(this).parent(".gallery").find(".stylist-img"),e=[],s=0,a=i.length;a>s;s++){var l={img:t(i[s]).attr("bigImgSrc")};e.push(l)}var o=t(this).index();L(e,o)})},L=function(t,e){var s;s=i.showSwipeBox(t,{initialSlide:e})};return{init:m}});