define(["jquery","commonUtils"],function(e,t){var s="",a={},i="",r="",l="",o=e("#rliImg"),c=e("#rliSalonName"),n=e("#rliItemName"),d=e("#rliText3"),p=e("#refundStatus"),u=(e("#cmNo"),e("#refundsDetail")),m=function(){a=t.checkLogin(),a&&(s=a.userId),t.addBack(function(){window.location="../appoint/appoint.html"}),t.addMenu(),i=t.getQueryString("ticketNo"),r=t.getQueryString("orderSn"),JSON.parse(window.sessionStorage.getItem("item")||window.localStorage.getItem("item"))&&(l=JSON.parse(window.sessionStorage.getItem("item")||window.localStorage.getItem("item")),g())},g=function(){if(i){var e={to:"refundInfo",type:"Fundflow",body:{userId:s,ticketNo:i}};t.ajaxRequest({data:e,successCallback:h.mFcallBack,url:apiConfig.orderApi})}else t.request({data:{orderSn:r},successCallback:h.mZcallBack,url:apiConfig.newApi+"order/refund-detail.html"})},h={mFcallBack:function(s){if(1==s.result){var a=s.data.main,r=a.status,m=a.message;u.attr("itemId",l.itemId),o.attr("src",l.imgUrl),c.text(l.salonName),n.text(l.itemName),d.text("有效期："+a.endTime),e("#cmNo").html('臭美券密码：<i class="main-color">'+i.substring(0,4)+" "+i.substring(4,8)+"</i>"),6==r||8==r?p.text("退款中").addClass("main-color"):7==r&&p.text("已退款"),e("#rdaMoney").text("￥"+a.priceAll),(6==r||7==r)&&e("#rdaTitle").text(a.route),h.renderRouteData(m),f()}else t.showTip(s.msg)},mZcallBack:function(s){if(0==s.code){var a=s.response,i=a.status,r=a.bookingSn,m=a.message;u.attr("orderSn",l.orderSn),o.attr("src",l.imgUrl),c.text(l.salonName),n.text(l.itemName),d.text("预约金￥"+a.priceAll),e("#cmNo").html('预约号：<i class="main-color">'+r.substring(0,4)+" "+r.substring(4,8)+"</i>"),"5"==i?p.text("退款中").addClass("main-color"):"6"==i&&p.text("已退款"),e("#rdaTitle").text(a.route),e("#rdaMoney").text("￥"+a.priceAll),h.renderRouteData(m),f()}else t.showTip(s.message)},renderRouteData:function(t){var s=t,a=[];a.push('<h3 class="rdf-title">退回流程:</h3>');var i={title:"退回余额"};s.one&&(i=s.one);var r={title:"臭美处理完成"};s.two&&(r=s.two);var l={title:"退款成功"};s.three&&(l=s.three),a.push('<dl class="item-icon-left'),i.desc||a.push(" grey ");var o=r.desc?"assertive":"grey";a.push('"><dt><span>'+i.title+'</span><i class="icon icon-circle icon-small bar-assertive">1</i></dt><dd class="border-'+o+'">'),i.desc&&a.push('<p class="grey">'+i.desc+"</p>"),i.remark&&a.push('<p class="grey">'+i.remark+"</p>"),a.push("</dd></dl>"),a.push('<dl class="item-icon-left'),r.desc||a.push(" grey ");var c=r.desc?"assertive":"grey",o=l.desc?"assertive":"grey";a.push('"><dt><span'),r.desc||a.push(' class="grey" '),a.push(">"+r.title+'</span><i class="icon icon-circle icon-small bar-'+c+'">2</i></dt><dd class="border-'+o+'">'),r.desc&&a.push('<p class="grey">'+r.desc+"</p>"),a.push("</dd></dl>"),a.push('<dl class="item-icon-left'),l.desc||a.push(" grey ");var c=l.desc?"assertive":"grey";a.push('"><dt><span'),l.desc||a.push(' class="grey" '),a.push(">"+l.title+'</span><i class="icon icon-circle icon-small bar-'+c+'">3</i></dt><dd class="border-'+c+'">'),l.desc&&a.push('<p class="grey">'+l.desc+"</p>"),l.tips&&a.push('<p class="grey main-color mt20">'+l.tips+"</p>"),a.push("</dd></dl>"),e(a.join("")).appendTo(e("#rdFlow"))}},f=function(){u.on("click",function(){var t=e(this).attr("orderSn"),s=e(this).attr("itemId");s?window.location="../home/itemDetail.html?itemId="+s:window.location="../appoint/appoint-detail.html?beautySn="+t})};return{init:m}});