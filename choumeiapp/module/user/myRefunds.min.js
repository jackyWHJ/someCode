define(["jquery","commonUtils"],function(t,e){var i="",s={},a="",o="refund",n=1,l=20,c=0,d=0,u=0,m=function(){s=JSON.parse(window.sessionStorage.getItem("user")||window.localStorage.getItem("user")),s?i=s.userId:(e.alert("你还没登录！请先登录！"),window.sessionStorage.setItem("location",window.location),window.location="userLogin.html"),p.getRefundsData(),e.goTop()},p={getRefundsData:function(){var t={to:"ticketFlow",type:"Fundflow",body:{userId:i,status:o,page:n,pageSize:l}};e.ajaxRequest({data:t,successCallback:this.getRefundsCallBack,url:apiConfig.orderApi})},getRefundsCallBack:function(e){if(e.result){var i=e.data.main,s=[],a=e.data.other.totalNum;0==a&&1==n&&t("#noRefundsTips").show();for(var o=0;o<i.length;o++){var c=i[o].status,d=i[o].itemType;7==c&&2==d?s.push('<div class="mtb-list special-price overdue-ticket" itemId='+i[o].itemid+" ticketNo="+i[o].ticketNo+">"):6==c&&2==d?s.push('<div class="mtb-list special-price" itemId='+i[o].itemid+" ticketNo="+i[o].ticketNo+">"):7==c&&1==d?s.push('<div class="mtb-list overdue-ticket" itemId='+i[o].itemid+" ticketNo="+i[o].ticketNo+">"):s.push('<div class="mtb-list" itemId='+i[o].itemid+" ticketNo="+i[o].ticketNo+">"),s.push('<div class="mtbl-info"><div class="mtbli-img sprite-img"></div>'),s.push('<div class="mtbli-text"><p class="mtblit-salon-name text-overflow">'+i[o].salonName+"</p>"),s.push('<p class="mtblit-item-name">'+i[o].itemName+"</p>"),s.push('<p class="mtblit-valid-time">有效期：'+i[o].limitTime+"</p>"),s.push("</div></div>"),s.push('<p class="mtbl-bottom">'),6==c?s.push('<span class="mtbl-ticket-status">退款中</span>'):7==c&&s.push('<span class="mtbl-ticket-status">已退款</span>'),s.push('<span class="mtbl-ticketno-text">臭美券密码'),s.push('<em class="ticket-no" id="mtbTicketNo">'+i[o].ticketNo.substring(0,4)+" "+i[o].ticketNo.substring(4,8)+"</em></span></p></div>")}if(t("#myRefundsBox").append(t(s.join(""))),a>l&&1==n){t(document).bind("scroll",p.addPageScrollListener)}n++,p.addRefundsListener()}},addRefundsListener:function(){t(".mtb-list").on("click",function(){a=t(this).attr("ticketNo"),window.location="refundsDetail.html?ticketNo="+a})},addPageScrollListener:function(){c=t(document).height(),d=t(document).scrollTop(),u=t(window).height(),d+u>=c&&p.getRefundsData()}};return{init:m}});