define(["jquery","commonUtils","utils/module/tongdun"],function(e,t,n){var o={},s="",a="",c=e("#btnActivate"),i=e("#activatePromocodeText"),d=e("#pbtciPromocode"),r=function(){o=t.checkLogin(),o&&(s=o.userId),t.addBack(),t.addMenu(),u.getPromocodeData(),e("#pbTabTitle li").on("click",function(){var n=e(this).index();e(".pb-tab-content").find(".pbtc-item").eq(n).removeClass("dn").siblings().addClass("dn"),e(this).addClass("pbtt-on").siblings().removeClass("pbtt-on"),1==n?c.on("click",function(){a=i.val(),a=a.replace(/\s+/g,""),""!=a?(u.getActivateData(),tongdun({url:"user/invite-code/consume.html",data:{authCode:a}})):t.showTip("邀请码不能为空！")}):u.getPromocodeData()})},u={getPromocodeData:function(){t.request({data:{userId:s},successCallback:function(e){if(0==e.code){var t=e.response.recommendedCode;t=t.substring(0,3)+"&nbsp;&nbsp;"+t.substring(3,7)+"&nbsp;&nbsp;"+t.substring(7,11),d.html(t)}},url:apiConfig.newApi+"user/my-recommended-code.html"})},getActivateData:function(){var e={userId:s,recommendedCode:a};t.request({data:e,successCallback:u.getActivateCallBack,url:apiConfig.newApi+"recommended-code/query.html"})},getActivateCallBack:function(e){if(0==e.code){var n=e.response,o=n.type,c=n.message;t.confirm(c,{okButtonText:"确认激活"},function(e){e&&t.request({data:{userId:s,type:o,recommendedCode:a},successCallback:function(e){0==e.code?t.showTip("激活成功"):t.showTip(e.message)},url:apiConfig.newApi+"recommended-code/submit.html"})})}else t.showTip(e.message)}};return{init:r}});